## AWS Route53

#Route53

---

1. Route53 の概要

# Route53 の概要

- DNS サービスを提供するサービス
- AWS が提供する権威 DNS サーバーで、ポート 53 で動作することから Route53 と呼ばれる
  (権威 DNS サーバー：基本的には名前解決をすることあるものをを基本権威 DNS サーバ豊美、名前をつけるできるので権威があると覚えるとわかりやすい)

## DNS とは ?

DNS はインターネットにおける人向けの URL をシステム向けの住所となる IP アドレスに変換するためのしくみである<br />
ex)<br />
https://xxxx.co.jp 　　->　　 DNS 　->　　 https://192.10.0.x<br />
会社（conpany）日本の(jp)　　　　　インターネットの住所 (ipv4 の例)<br />

xxxx.co.jp は人が見てわかりやすいものに変えただけで、インターネットの住所ではない。それを DNS(Route53) を利用することで紐付けることができる

# Route53 は権威 DNS サーバーの機能をマネジメント型で簡単に利用可能<br />

※ AWS 側で基本的に管理しているのでユーザ側で管理する必要がほぼない

- 主要機能はドメイン登録／DNS ルーティング／ヘルスチェックの 3 つ
- ポリシーによるルーティング設定
  - トラフィックルーティング/フェイルオーバー/トラフィックフローに基づく様々な条件のルーティング設定が可能
- AWS 側で 100％可用性を保証する SLA
  　＊ (AWS 側で絶対に落ちないよという保証がされている)
- マネージドサービスとして提供しており、ユーザー側で冗長性などを考慮する必要がない

# Route53 の利用方法

Route53 の利用を開始してドメインを登録するとホストゾーン
を自動生成し、そこにルーティングを設定する。

1. Route53 にドメインを設定<br />
   　　 ↓
2. ドメイン名と同じホストゾーンを自動生成<br />
   　　 ↓
3. ホストゾーンにルーティング方法となる DNS レコードを作成<br />
   　　 ↓
4. トラフィックルーティングを設定<br />

## 2. ドメイン名と同じホストゾーンを自動生成

# ホストゾーン

ドメイン（example.com）とそのサブドメイン(sub.example.com） のトラフィックのルーティングする方法についての情報を保持するコンテナ

| パブリックホストゾーン                                                       |
| :--------------------------------------------------------------------------- |
| ・ インターネット上に公開された DNS ドメインレコードを管理するコンテナ       |
| ・ インターネットの DNS ドメインに対するトラフィックのルーティング方法を定義 |

<br />

| プライベートホストゾーン                                                               |
| :------------------------------------------------------------------------------------- |
| ・ VPC に閉じたプライベートネットワーク内の DNS ドメインのレコードを管理するコンテナ   |
| ・ VPC 内の DNS ドメインに対して、どのようにトラフィックをルーティングするかを定義     |
| ・ 1 つのプライベートホストゾーンで複数 VPC に対応                                     |
| ・ VPC が相互アクセス可能であれば複数リージョンの VPC でも、同じホストゾーンを利用可能 |

# DNS レコード

| SOA                                                                                                                                            |
| :--------------------------------------------------------------------------------------------------------------------------------------------- |
| ・ ドメインの DNS サーバー／ドメイン管理者のメール・アドレス／シリアル番号などを保持して、ゾーン転送時に情報が更新されているかの判断に利用する |

| A                                                     |
| :---------------------------------------------------- |
| ・ ホスト名と IP アドレスの関連づけを定義するレコード |

| MX                                                            |
| :------------------------------------------------------------ |
| ・ メールの配送先（メールサーバ）のホスト名を定義するレコード |

| CNAME                                                                                                                                                                                      |
| :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ・ 正規ホスト名に対する別名を定義するレコード。特定のホスト名を別のドメイン名に転送する時などに利用する (外部のドメイン([お名前.com](https://www.onamae.com/) のサイト)を使用する時に使う) |

| ALIAS レコード                                                                                                                      |
| :---------------------------------------------------------------------------------------------------------------------------------- |
| ・ DNS クエリに AWS サービスのエンドポイントの IP アドレスを返答                                                                    |
| ・ 以下のサービスを設定可能 (静的ウェブサイトとして設定された S3 バケット, CloudFront, ELB, ホストゾーン内のリソースレコード)セット |
| ・ AWS が提供している Route53 固有の仮想リソースレコード                                                                            |

<br />
他のレコードタイプは以下を参照<br />
https://docs.aws.amazon.com/ja_jp/Route53/latest/DeveloperGuide/ResourceRecordTypes.html

# トラフィックルーティンのタイプ

様々なルーティング方式を選択して設計することが可能

| シンプルルーティング（Simple）                                           |
| :----------------------------------------------------------------------- |
| ・ レコードセットで事前に設定された値のみに基づいて DNS クエリに応答する |
| ・ 静的なマッピングによりルーティングを決定                              |

| 加重ルーティング(Weighted)                                   |
| :----------------------------------------------------------- |
| ・ 複数エンドポイント毎の重み設定により DNS クエリに応答する |
| ・ 重み付けの高いエンドポイントに多くルーティングする        |

| レイテンシールーティング(Latency)                   |
| :-------------------------------------------------- |
| ・ リージョンの遅延状況により DNS クエリに応答する  |
| ・ リージョン間の遅延が少ない方へルーティングされる |

| フェイルオーバールーティング(Failover)                                       |
| :--------------------------------------------------------------------------- |
| ・ ヘルスチェックの結果に基づいて、利用可能なリソースを DNS クエリに応答する |
| ・ 利用可能なリソースにのみルーティングされる                                |

| 位置情報ルーティング(Geolocation)                                |
| :--------------------------------------------------------------- |
| ・ クライアントの位置情報に基づき DNS クエリに応答する           |
| ・ 特定の地域・国からの DNS クエリに対して、特定のアドレスを応答 |

| マルチバリュールーティング（Multivalue）                     |
| :----------------------------------------------------------- |
| ・ 別々のレコードに IP アドレスを設定する                    |
| ・ IP アドレス単位でヘルスチェックを実施してルーティングする |

# 備考

- [ホストゾーンの設定](https://docs.aws.amazon.com/ja_jp/Route53/latest/DeveloperGuide/CreatingHostedZone.html)
- [AWS Route 53 を使って独自ドメインの設定](https://avinton.com/academy/route53-dns-vhost/)

# 外部作成ドメインサイト

- [お名前.com](https://www.onamae.com/)
- [freenom](https://www.freenom.com/ja/freeandpaiddomains.html)
