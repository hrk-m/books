# 2020/11

# 11/28

## kubernetes

ã‚³ãƒ³ãƒ†ãƒŠã‚’ä¸€ã¤èµ·å‹•ã•ã›ã€3 ã¤ã‚¹ã‚±ãƒ¼ãƒ«ã‚¤ãƒ³ã™ã‚‹

### ç’°å¢ƒæº–å‚™

```bash
# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
$ brew install minikubeã€€

# ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª
$ minikube version
## minikube version: v1.15.1
## commit: 23f40a012abb52eff365ff99a709501a61ac5876
```

### Minikube ã®èµ·å‹•ã‚’ç¢ºèª

- kubernetes ã®ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’èµ·å‹•

```bash
# èµ·å‹•
$ minikube start
# # ğŸ˜„  Darwin 10.15.7 ä¸Šã® minikube v1.15.1
# # âœ¨  dockerãƒ‰ãƒ©ã‚¤ãƒãƒ¼ãŒè‡ªå‹•çš„ã«é¸æŠã•ã‚Œã¾ã—ãŸ
# # ğŸ‘  ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ãƒ¼ãƒ³ã®ãƒãƒ¼ãƒ‰ minikube ã‚’ minikube ä¸Šã§èµ·å‹•ã—ã¦ã„ã¾ã™
# # ğŸšœ  Pulling base image ...
# # ğŸ’¾  Kubernetes v1.19.4 ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã®æº–å‚™ã‚’ã—ã¦ã„ã¾ã™
# #     > preloaded-images-k8s-v6-v1.19.4-docker-overlay2-amd64.tar.lz4: 486.35 MiB

# # ğŸ”¥  docker container (CPUs=2, Memory=1987MB) ã‚’ä½œæˆã—ã¦ã„ã¾ã™...
# # ğŸ³  Docker 19.03.13 ã§ Kubernetes v1.19.4 ã‚’æº–å‚™ã—ã¦ã„ã¾ã™...
# # ğŸ”  Kubernetes ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æ¤œè¨¼ã—ã¦ã„ã¾ã™...
# # ğŸŒŸ  æœ‰åŠ¹ãªã‚¢ãƒ‰ã‚ªãƒ³: storage-provisioner, default-storageclass
# # ğŸ„  Done! kubectl is now configured to use "minikube" cluster and "default" namespace by default

# ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª
$ minikube status
# # minikube
# # type: Control Plane
# # host: Running
# # kubelet: Running
# # apiserver: Running
# # kubeconfig: Configured
```

### node ãŒã‚ã‚‹ã“ã¨ã‚’ç¢ºèª

```bash
$ kubectl get node
NAME       STATUS   ROLES    AGE     VERSION
minikube   Ready    master   6m51s   v1.19.4  <- minikube ãŒã‚ã‚Œã°OK
```

### --- ã‚³ãƒ³ãƒ†ãƒŠã‚’ä¸€ã¤èµ·å‹•ã•ã›ã€3 ã¤ã‚¹ã‚±ãƒ¼ãƒ«ã‚¤ãƒ³ã™ã‚‹ ---

### ã‚³ãƒ³ãƒ†ãƒŠã®ä½œæˆ

```bash
$ kubectl run nginx --image=nginx --generator=run-pod/v1
```

### deployment ã®ä½œæˆ

```bash
kubectl create deployment nginx --image=nginx
```

### ã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèª

```bash
$ watch -t "kubectl get pod,service,deployment"

NAME                         READY   STATUS    RESTARTS   AGE
pod/nginx                    1/1     Running   0          2m1s
pod/nginx-6799fc88d8-g98ck   1/1     Running   0          77s

NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
service/kubernetes   ClusterIP   10.96.0.1    <none>        443/TCP   3m32s

NAME                    READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/nginx   1/1     1            1           77s
```

### ã‚³ãƒ³ãƒ†ãƒŠã‚’ 3 ã¤ã«ã‚¹ã‚±ãƒ¼ãƒ«ã‚¤ãƒ³ã™ã‚‹

```bash
$ kubectl scale --replicas=3 deploy/nginx
```

### ã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèª

- 3 ã¤ã«ã‚¹ã‚±ãƒ¼ãƒ«ã‚¤ãƒ³ã—ã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã‚‹

```bash
$ watch -t "kubectl get pod,service,deployment"

NAME                         READY   STATUS    RESTARTS   AGE
pod/nginx                    1/1     Running   0          3m7s
pod/nginx-6799fc88d8-9svbw   1/1     Running   0          20s
pod/nginx-6799fc88d8-g98ck   1/1     Running   0          2m23s
pod/nginx-6799fc88d8-l5pb6   1/1     Running   0          20s

NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
service/kubernetes   ClusterIP   10.96.0.1    <none>        443/TCP   4m38s

NAME                    READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/nginx   3/3     3            3           2m23s
```

### å‰Šé™¤

```bash
$ kubectl delete deploy nginx

# ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®å‰Šé™¤
$ minikube delete
# ğŸ”¥  docker ã®ã€Œminikubeã€ã‚’å‰Šé™¤ã—ã¦ã„ã¾ã™...
# ğŸ”¥  ã‚³ãƒ³ãƒ†ãƒŠ "minikube" ã‚’å‰Šé™¤ã—ã¦ã„ã¾ã™...
# ğŸ”¥  /Users/harukimiyagi/.minikube/machines/minikube ã‚’å‰Šé™¤ã—ã¦ã„ã¾ã™...
# ğŸ’€  ã‚¯ãƒ©ã‚¹ã‚¿ "minikube" ã®å…¨ã¦ã®ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚
```

### å‚è€ƒã«ãªã‚‹ã‚µã‚¤ãƒˆ

- [Minikube ã§ã¯ã˜ã‚ã‚‹ Kubernetes å…¥é–€](https://qiita.com/nirasan/items/6207cf7ef94e04640fbf)
- [ãƒãƒ‹ãƒ¥ãƒ•ã‚§ã‚¹ãƒˆ(YAML)ã‚’ä½œã‚‰ãšã€kubectl ã‚³ãƒãƒ³ãƒ‰ã§ Pod ã‚„ Deploymentã€Service ã‚’ä½œæˆã™ã‚‹æ–¹æ³•ã®ãƒ¡ãƒ¢(kubectl run/kubectl create/kubectl scale/kubectl expose)](https://qiita.com/toshihirock/items/8d79fa32c61c921c0b3b)
- [Kubernetes ãƒãƒ³ã‚ºã‚ªãƒ³](https://www.nic.ad.jp/ja/materials/iw/2018/proceedings/h2/h2-takara-4.pdf)

# 11/29

### watch ã‚³ãƒãƒ³ãƒ‰

```bash
$ watch ã‚³ãƒãƒ³ãƒ‰
```

ã‚³ãƒãƒ³ãƒ‰ã‚’ 2 ç§’é–“éš”ã§ç¹°ã‚Šè¿”ã—å®Ÿè¡Œã™ã‚‹

- å®Ÿè¡Œä¾‹

```bash
$ watch -n 5 ls /tmp
```

| option  | description                                        |
| ------- | -------------------------------------------------- |
| -t      | ãƒ˜ãƒƒãƒ€ã‚’è¡¨ç¤ºã—ãªã„                                 |
| -d      | ç›´å‰ã®å®Ÿè¡Œçµæœã‹ã‚‰å¤‰åŒ–ã—ãŸç®‡æ‰€ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤ºã™ã‚‹ |
| -n ç§’æ•° | å®Ÿè¡Œé–“éš”ã‚’ç§’æ•°ã§æŒ‡å®šã™ã‚‹                           |
| -p      | ã‚³ãƒãƒ³ãƒ‰ã®çµæœã ã‘ã‚’è¡¨ç¤º                           |

# 11/30
